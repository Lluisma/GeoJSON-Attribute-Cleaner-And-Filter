<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>GeoJSON Attribute Cleaner And Filter</title>
	<style>
		* { font-family: Arial, Helvetica, sans-serif; }
	</style>
	<script type="text/javascript">

		var presProp, filtProp, filtVal, filtVals, geoinput, geooutput;  
		
		window.onload = function() {
			presProp  = document.getElementById('preserved_prop');
	  		filtProp  = document.getElementById('filter_prop');
	  		filtVal   = document.getElementById('filter_value');
	  		filtVals  = document.getElementById('filter_values');
	  		geoinput  = document.getElementById('geo-input');
	  	    geooutput = document.getElementById('geo-output');
		}

	  	function properties() {
			// * Remove items
	  		for (var i = presProp.length - 1; i>=0; i--) {
				presProp.remove(i);
			}
			for (var i = filtProp.length - 1; i>0; i--) {
				filtProp.remove(i);
	  		}
			
			var converted  = JSON.parse( geoinput.value );
			var feat       = converted.features[0];
			var j = 0;
			for (var prop in feat.properties) {				  
				var opt = document.createElement('option');
					opt.value = prop;
					opt.innerHTML = prop;
					presProp.appendChild(opt);
					if (prop=="iso_a2") { presProp.selectedIndex = j; }
				var opt2 = document.createElement('option');
					opt2.value = prop;
					opt2.innerHTML = prop;
					filtProp.appendChild(opt2);
				j++;
	  		}
		}
	
		function values() {
			// * Remove items
	  		for (var i = filtVals.length - 1; i>=0; i--) {
				filtVals.remove(i);
	  		}
			var arrValors = new Array();
			var filtPropVal = filtProp.value;
			var converted = JSON.parse( geoinput.value );
			for (var i=0; i<converted.features.length; i++) {
		  		var feat = converted.features[i];
		  		var val  = feat.properties[ filtPropVal ];
		  		if (arrValors.indexOf(val) < 0) { 
			  		arrValors.push(val);
			  		var opt = document.createElement('option');
						opt.value = val;
						opt.innerHTML = val;
					filtVals.appendChild(opt);
		  		}
			}
		}
	
		function process() {
			var arrPresProp = new Array();
			for (i = 0; i < presProp.length; i++) {
				if (presProp.options[i].selected) {
					arrPresProp[i] = presProp.options[i].value;
				}
			}
	 	    arrPresProp.push("name"); // * Field containing country name to keep
			var filtProperty = filtProp.value;
			var filtValue    = filtVal.value;
			var converted    = JSON.parse( geoinput.value );
	
			var i = 0;
			var feat;

			while (feat = converted.features[i]) {
		  		if ((filtProperty==false) || (feat.properties.hasOwnProperty( filtProperty ) && (feat.properties[ filtProperty ]==filtValue))) {
  					for (var prop in feat.properties) {
  										  
   		      		if ( arrPresProp.indexOf( prop ) < 0) {
  		      			delete feat.properties[prop];
   		      		}
   		    		}
        			i++;  
          		} else {
        			converted.features.splice(i,1);
          		}
			}	
			geooutput.value = JSON.stringify( converted );
		}

	</script>
</head>
<body>
	<h2>GeoJSON Attribute Cleaner and Filter</h2>
	<p>Paste GeoJSON here:</p>
	<textarea id="geo-input" rows="20" cols="100">
		
		{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"scalerank":1,"featurecla":"Admin-0mapunit","labelrank":5.0,"sovereignt":"Barbados","sov_a3":"BRB","adm0_dif":0.0,"level":2.0,"type":"Sovereigncountry","admin":"Barbados","adm0_a3":"BRB","geou_dif":0.0,"geounit":"Barbados","gu_a3":"BRB","su_dif":0.0,"subunit":"Barbados","su_a3":"BRB","brk_diff":0.0,"name":"Barbados","name_long":"Barbados","brk_a3":"BRB","brk_name":"Barbados","brk_group":null,"abbrev":"Barb.","postal":"BB","formal_en":"Barbados","formal_fr":null,"note_adm0":null,"note_brk":null,"name_sort":"Barbados","name_alt":null,"mapcolor7":4.0,"mapcolor8":1.0,"mapcolor9":5.0,"mapcolor13":3.0,"pop_est":284589.0,"gdp_md_est":5425.0,"pop_year":-99.0,"lastcensus":2010.0,"gdp_year":-99.0,"economy":"6.Developingregion","income_grp":"2.Highincome:nonOECD","wikipedia":-99.0,"fips_10":null,"iso_a2":"BB","iso_a3":"BRB","iso_n3":"052","un_a3":"052","wb_a2":"BB","wb_a3":"BRB","woe_id":-99.0,"adm0_a3_is":"BRB","adm0_a3_us":"BRB","adm0_a3_un":-99.0,"adm0_a3_wb":-99.0,"continent":"NorthAmerica","region_un":"Americas","subregion":"Caribbean","region_wb":"LatinAmerica&Caribbean","name_len":8.0,"long_len":8.0,"abbrev_len":5.0,"tiny":3.0,"homepart":1.0},"geometry":{"type":"Polygon","coordinates":[[[-59.493,13.082],[-59.611,13.102],[-59.647,13.303],[-59.592,13.318],[-59.428,13.153],[-59.493,13.082]]]}}]}

		
		
	</textarea>
	<br />
	
	<style>
		table			{	width:720px; border:1px solid #ccc; }
		td				{	text-align:center; vertical-align:top; }
		select, input	{	width:220px; }
		
	</style>
	
	<p>
		<input type="button" id="button-get" onclick="javascript:properties();" value="Get Properties" style="margin-left: 100px; width: 300px;" />
	</p>
	
	<table>
		<tr><td colspan="3"></td></tr>
		<tr><th>Properties preserved</th>
			<th>Filter property</th>
			<th>Filter value</th></tr>
		<tr><td><select id="preserved_prop" size="10" multiple></select></td>
			<td><select id="filter_prop">
					<option></option>
				</select>
				<p><input type="button" id="button-get" onclick="javascript:values();" value="Get Values >>" style="width: 220px;" /></p></td>
			<td><input id="filter_value" list="filter_values"/>
				<datalist id="filter_values"></datalist></td></tr>
	</table>
	 
	<br />	
	<p>
		<input type="button" id="button-go"  onclick="javascript:process();" value="Process" style="margin-left: 100px; width: 300px;" />
	</p>

	<p>Cleaned output:</p>
	<textarea id="geo-output" rows="20" cols="100"></textarea>
	<p style="font-size: 0.7em; font-style: italic;">Copy and paste this result in a JSON file.</p>
</body>
</html>




